<!-- index.html -->
<!DOCTYPE html>
<html>
<head>
    <title>교육용 AI 챗봇</title>
    <style>
        body { font-family: Arial; padding: 20px; }
        #chat { display: none; } /* 처음엔 채팅창 숨김 */
    </style>
</head>
<body>
    <!-- 로그인 화면 -->
    <div id="login">
        <h3>🔒 교육용 접속 코드</h3>
        <input type="password" id="code" placeholder="비밀코드 입력">
        <input type="text" id="name" placeholder="이름 입력">
        <button onclick="checkCode()">시작하기</button>
    </div>

    <!-- 채팅 화면 -->
    <div id="chat">
        <div id="messages"></div>
        <input type="text" id="input">
        <button onclick="send()">전송</button>
    </div>

    <script>
    // 1. 기본 설정
    let userName = "";
    const SECRET_CODE = "hello123"; // 🔑 비밀 접속 코드 (원하는 비밀번호로 변경하세요!)
    
    // 2. 비밀번호 확인 함수 (login 화면)
    function checkCode() {
        const inputCode = document.getElementById('code').value;
        userName = document.getElementById('name').value;

        if(inputCode === SECRET_CODE && userName) {
            document.getElementById('login').style.display = 'none';
            document.getElementById('chat').style.display = 'block';
        } else {
            alert('❌ 잘못된 코드 또는 이름입니다!');
        }
    }

    // 3. 채팅 기능 (chat 화면) - send() 함수는 5단계에서 Gemini API에 맞게 수정!
    async function send() {
        const input = document.getElementById('input').value;
        const messagesDiv = document.getElementById('messages');

        // 👤 사용자 메시지 화면에 표시 (기존 코드와 동일)
        messagesDiv.innerHTML += `<div>👤 ${userName}: ${input}</div>`;

        // ✅ Cloudflare Worker URL (4단계에서 복사한 Worker 주소로 변경!) - 이전과 동일
        const workerUrl = 'https://tongdo-api.aelagth.workers.dev'; // 👈👈👈 여기에 복사한 Worker URL 붙여넣으세요!

        // 🤖 AI 응답 받기 (Cloudflare Worker 호출) - Gemini API 요청
        const response = await fetch(workerUrl, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(input) // 👈 요청 body에 사용자 입력 텍스트만 그대로 전달 (Worker에서 Gemini API 형식으로 변환)
        });

        const data = await response.json(); // 응답 데이터를 JSON 형식으로 변환
        const aiResponse = data.candidates[0].content.parts[0].text; // 👈 Gemini API 응답 구조에 맞춰 응답 텍스트 추출

        // 🤖 AI 응답 화면에 표시
        messagesDiv.innerHTML += `<div>🤖 Gemini AI: ${aiResponse}</div>`; // 👈 AI 이름 Gemini AI로 변경
    
        document.getElementById('input').value = ''; // 메시지 입력창 초기화 (기존 코드와 동일)
    }
    </script>
</body>
</html>
