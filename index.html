<!-- index.html -->
<!DOCTYPE html>
<html>
<head>
    <title>통쾌한 도전을 위한 AI 챗봇</title>
    <style>
        body {
        font-family: 'Noto Sans KR', sans-serif; /* ✨ 예쁜 폰트! (Noto Sans Korean) ✨ */
        margin: 0; /* body 기본 margin 제거 */
        padding: 0; /* body 기본 padding 제거 */
        background-color: #f0f0f0; /* 전체 배경색: 밝은 회색 */
        display: flex; /* flexbox 레이아웃 사용 */
        justify-content: center; /* 가로 중앙 정렬 */
        align-items: center; /* 세로 중앙 정렬 */
        min-height: 100vh; /* 최소 높이: 뷰포트 높이 (화면 전체 채우기) */
        }

    #login, #chat {
        background-color: #fff; /* 로그인/채팅창 배경색: 흰색 */
        border-radius: 15px; /* 둥근 테두리 */
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1); /* 그림자 효과 */
        padding: 30px; /* 내부 여백 */
        text-align: center; /* 텍스트 중앙 정렬 */
        width: 400px; /* 적당한 너비 */
        max-width: 90%; /* 최대 너비: 화면 너비의 90% (반응형) */
    }

    #chat {
        display: none; /* 채팅창 숨김 (기본) */
        height: 600px; /* 채팅창 높이 */
        display: flex; /* flexbox 레이아웃 (세로 방향) */
        flex-direction: column; /* 요소 세로로 배치 */
    }

    #login h3, #chat h3 {
        margin-top: 0; /* 제목 margin-top 제거 */
        color: #333; /* 제목 글자색: 진한 회색 */
    }

    #login input, #chat input {
        padding: 10px; /* 입력창 내부 여백 */
        margin: 10px 0; /* 입력창 상하 margin */
        border: 1px solid #ccc; /* 입력창 테두리 */
        border-radius: 5px; /* 입력창 둥근 테두리 */
        width: calc(100% - 22px); /* 입력창 너비 (padding, border 고려) */
        box-sizing: border-box; /* box-sizing: border-box (padding, border가 width에 포함되도록) */
    }

    #login button, #chat button {
        padding: 10px 20px; /* 버튼 내부 여백 */
        background-color: #4CAF50; /* 버튼 배경색: 녹색 */
        color: white; /* 버튼 글자색: 흰색 */
        border: none; /* 버튼 테두리 제거 */
        border-radius: 5px; /* 버튼 둥근 테두리 */
        cursor: pointer; /* 마우스 커서: 손가락 모양 */
        font-size: 16px; /* 버튼 글자 크기 */
        transition: background-color 0.3s ease; /* 배경색 변경 애니메이션 */
    }

    #login button:hover, #chat button:hover {
        background-color: #45a049; /* 버튼 hover 배경색: 살짝 어두운 녹색 */
    }

    #messages {
        flex-grow: 1; /* messages 영역이 남은 공간 모두 차지 */
        padding: 20px; /* 메시지 영역 내부 여백 */
        overflow-y: auto; /* 세로 스크롤 자동 생성 (메시지 넘칠 때) */
        display: flex; /* flexbox 레이아웃 (세로 방향) */
        flex-direction: column; /* 요소 세로로 배치 */
    }

    #messages div {
        margin-bottom: 10px; /* 메시지 간 간격 */
        padding: 10px 15px; /* 메시지 버블 내부 여백 */
        border-radius: 20px; /* 메시지 버블 둥근 테두리 */
        background-color: #e0e0e0; /* 기본 메시지 버블 배경색: 밝은 회색 */
        word-wrap: break-word; /* 긴 단어 줄바꿈 */
        max-width: 80%; /* 메시지 버블 최대 너비 */
    }

    #messages div:nth-child(odd) { /* 홀수 번째 메시지 (사용자 메시지) */
        background-color: #DCF8C6; /* 사용자 메시지 버블 배경색: 연한 녹색 */
        align-self: flex-end; /* 사용자 메시지 오른쪽 정렬 */
    }

    #chat input {
        margin: 0; /* 채팅 입력창 margin 제거 */
        border-radius: 0; /* 채팅 입력창 테두리 둥글기 제거 */
        border-top: 1px solid #ccc; /* 채팅 입력창 위쪽 테두리만 */
        border-right: none; /* 채팅 입력창 오른쪽 테두리 제거 */
        border-left: none; /* 채팅 입력창 왼쪽 테두리 제거 */
    }

    #chat button {
        border-radius: 0; /* 채팅 전송 버튼 테두리 둥글기 제거 */
        border-bottom-right-radius: 15px; /* 채팅 전송 버튼 오른쪽 아래 테두리만 둥글게 (채팅창과 맞춰서) */
        border-top-right-radius: 15px; /* 채팅 전송 버튼 오른쪽 위 테두리만 둥글게 (채팅창과 맞춰서) */
    }

    /* 스크롤바 스타일 (선택 사항, Chrome, Edge, Safari 등 Webkit 기반 브라우저) */
    #messages::-webkit-scrollbar {
        width: 8px; /* 스크롤바 너비 */
    }

    #messages::-webkit-scrollbar-thumb {
        background-color: #888; /* 스크롤바 색상 */
        border-radius: 4px; /* 스크롤바 둥근 테두리 */
    }

    #messages::-webkit-scrollbar-thumb:hover {
        background-color: #555; /* 스크롤바 hover 색상 */
    }
        #chat { display: none; } /* 처음엔 채팅창 숨김 */
    </style>
</head>
<body>
    <!-- 로그인 화면 -->
    <div id="login">
        <h3>🔒 교육용 접속 코드</h3>
        <input type="password" id="code" placeholder="비밀코드 입력">
        <input type="text" id="name" placeholder="이름 입력">
        <button onclick="checkCode()">시작하기</button>
    </div>

    <!-- 채팅 화면 -->
    <div id="chat">
        <div id="messages"></div>
        <input type="text" id="input">
        <button onclick="send()">전송</button>
    </div>

    <script>
    // 1. 기본 설정
    let userName = "";
    const SECRET_CODE = "tongdo123"; // 🔑 비밀 접속 코드 (원하는 비밀번호로 변경하세요!)
    
    // 2. 비밀번호 확인 함수 (login 화면)
    function checkCode() {
        const inputCode = document.getElementById('code').value;
        userName = document.getElementById('name').value;

        if(inputCode === SECRET_CODE && userName) {
            document.getElementById('login').style.display = 'none';
            document.getElementById('chat').style.display = 'block';
        } else {
            alert('❌ 잘못된 코드 또는 이름입니다!');
        }
    }

    // 3. 채팅 기능 (chat 화면) - send() 함수는 5단계에서 Gemini API에 맞게 수정!
    async function send() {
        const input = document.getElementById('input').value;
        const messagesDiv = document.getElementById('messages');

        // 👤 사용자 메시지 화면에 표시 (기존 코드와 동일)
        messagesDiv.innerHTML += `<div>👤 ${userName}: ${input}</div>`;

        // ✅ Cloudflare Worker URL (4단계에서 복사한 Worker 주소로 변경!) - 이전과 동일
        const workerUrl = 'https://tongdo-api.aelagth.workers.dev'; // 👈👈👈 여기에 복사한 Worker URL 붙여넣으세요!

        // 🤖 AI 응답 받기 (Cloudflare Worker 호출) - Gemini API 요청
        const response = await fetch(workerUrl, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(input) // 👈 요청 body에 사용자 입력 텍스트만 그대로 전달 (Worker에서 Gemini API 형식으로 변환)
        });

        const data = await response.json(); // 응답 데이터를 JSON 형식으로 변환
        const aiResponse = data.candidates[0].content.parts[0].text; // 👈 Gemini API 응답 구조에 맞춰 응답 텍스트 추출

        // 🤖 AI 응답 화면에 표시
        messagesDiv.innerHTML += `<div>🤖 통도AI: ${aiResponse}</div>`; // 👈 AI 이름 Gemini AI로 변경
    
        document.getElementById('input').value = ''; // 메시지 입력창 초기화 (기존 코드와 동일)
    }
    </script>
</body>
</html>
